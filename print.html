<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>KASM Documentation</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="chapter_1.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="chapter_2.html"><strong aria-hidden="true">2.</strong> Running KASM</a></li><li class="chapter-item expanded "><a href="chapter_3.html"><strong aria-hidden="true">3.</strong> KASM Language</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="chapter_3_1.html"><strong aria-hidden="true">3.1.</strong> For Beginners</a></li><li class="chapter-item expanded "><a href="chapter_3_2.html"><strong aria-hidden="true">3.2.</strong> Basic Syntax</a></li><li class="chapter-item expanded "><a href="chapter_3_3.html"><strong aria-hidden="true">3.3.</strong> Data Types</a></li><li class="chapter-item expanded "><a href="chapter_3_4.html"><strong aria-hidden="true">3.4.</strong> Expressions</a></li><li class="chapter-item expanded "><a href="chapter_3_5.html"><strong aria-hidden="true">3.5.</strong> Full Instructions List</a></li></ol></li><li class="chapter-item expanded "><a href="chapter_4.html"><strong aria-hidden="true">4.</strong> KASM Preprocessor</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="chapter_4_1.html"><strong aria-hidden="true">4.1.</strong> Definitions</a></li><li class="chapter-item expanded "><a href="chapter_4_2.html"><strong aria-hidden="true">4.2.</strong> Macros</a></li></ol></li><li class="chapter-item expanded "><a href="chapter_5.html"><strong aria-hidden="true">5.</strong> Assembler Directives</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="chapter_5_1.html"><strong aria-hidden="true">5.1.</strong> Include Directive</a></li><li class="chapter-item expanded "><a href="chapter_5_2.html"><strong aria-hidden="true">5.2.</strong> If* Directives</a></li></ol></li><li class="chapter-item expanded "><a href="chapter_6.html"><strong aria-hidden="true">6.</strong> Output</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">KASM Documentation</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#chapter-1-introduction" id="chapter-1-introduction">Chapter 1: Introduction</a></h1>
<h2><a class="header" href="#what-is-kasm" id="what-is-kasm">What is KASM?</a></h2>
<p>The Kerbal Assembler, KASM, is an assembler created for the popular Kerbal Space Program mod kOS. The syntax is designed to be easy to understand and allow the user to write any code they could possibly write in kOS's native language KerbalScript, but with more flexibility. It currently supports all kOS instructions and the toolchain to create executable Kerbal Machine Code files or KSM files. It also has strong macro support.</p>
<h2><a class="header" href="#license" id="license">License</a></h2>
<p>KASM is under the GPL 3.0 License.</p>
<h1><a class="header" href="#chapter-2-running-kasm" id="chapter-2-running-kasm">Chapter 2: Running KASM</a></h1>
<h2><a class="header" href="#main-operation" id="main-operation">Main Operation</a></h2>
<p>To assemble a file, you issue a command of the form:</p>
<pre><code>kasm &lt;filename&gt; [options]
</code></pre>
<p>For example:</p>
<pre><code>kasm myfile.kasm
</code></pre>
<p>will assemble <code>myfile.kasm</code> into a KO object file <code>myfile.ko</code></p>
<h2><a class="header" href="#creating-an-executable" id="creating-an-executable">Creating an Executable</a></h2>
<p>Because KASM is just an assembler, and it produces a non-executable file, readers of this may be wondering how to create a file they can run in kOS.</p>
<p>See <a href="https://github.com/newcomb-luke/kOS-KLinker">KLinker</a>.</p>
<p>If you already have KLinker installed, then in order to create an executable from one single file, run:</p>
<pre><code>kasm myfile.kasm
klinker myfile.ko -o program.ksm
</code></pre>
<p>The produced <code>program.ksm</code> file can then be run in kOS just like any other file.</p>
<h2><a class="header" href="#options" id="options">Options</a></h2>
<p>To get further usage instructions from KASM itself, run:</p>
<pre><code>kasm --help
</code></pre>
<h4><a class="header" href="#the--o-option-specifying-the-output-file-name" id="the--o-option-specifying-the-output-file-name">The <code>-o</code> Option: Specifying the Output File Name</a></h4>
<p>KASM will normally choose the output file for you. By default, KASM will strip the <code>.kasm</code> extension from the filename, and store the output file with a <code>.ko</code> extension in the same directory as the input file.</p>
<p>If the output file already exists, KASM will overwrite it. Only the output extension of <code>.ko</code> is allowed.</p>
<p>For situations in which the output file needs to be placed in a seperate directory, or needs to be named differently, KASM provides the <code>-o</code> command-line option, which allows you to specify your desired output path or file name.</p>
<p>For example:</p>
<pre><code>kasm main_program.kasm -o game.ko
</code></pre>
<p>This will produce an output file named <code>game.ko</code> in the current working directory.</p>
<h4><a class="header" href="#the--i-option-specifying-the-include-directory" id="the--i-option-specifying-the-include-directory">The <code>-i</code> Option: Specifying the Include Directory</a></h4>
<p>KASM contains a preprocessor which allows the user to include source code from other files into the file that is being assembled. Normally KASM looks for these other files in a path relative to the source <code>.kasm</code> file's directory. Sometimes one might want a common place for commonly used source code such as macro definitions. Instead of having to copy all of those files to the source code's directory, KASM allows a different include path to be chosen.</p>
<p>This can be done with the <code>-i</code> command line option:</p>
<p>Mac/Linux:</p>
<pre><code>kasm fancycode.kasm -i ../macros/
</code></pre>
<p>Windows:</p>
<pre><code>kasm fancycode.kasm -i ..\macros\
</code></pre>
<h4><a class="header" href="#the--f-option-specifying-the-file-symbol-name" id="the--f-option-specifying-the-file-symbol-name">The <code>-f</code> Option: Specifying the File Symbol Name</a></h4>
<p>Normally KASM outputs to the KerbalObject file format, which stores the source file's name to be referenced later in the case of any errors. This defaults to the current file name, but in the case of implementing an intermediary between the user and KASM such as a compiler, a different source file name should be displayed.</p>
<p>This can be done through the <code>-f</code> option:</p>
<pre><code>kasm compiled.kasm -f compiled.someother
</code></pre>
<p>Now errors will be reported as coming from the <code>compiled.someother</code> file.</p>
<h4><a class="header" href="#the--c-option-specifying-the-executable-comment" id="the--c-option-specifying-the-executable-comment">The <code>-c</code> Option: Specifying the Executable Comment</a></h4>
<p>When the output KerbalObject file is linked and an executable file is created, a comment is left in the generated KSM file that explains how the file was created. This can be read using a utility such as <a href="https://github.com/newcomb-luke/KDump">KDump</a> and then the recipient of the file can see what program compiled the code.</p>
<p>An example comment would currently be: <code>Assembled by KASM v0.9.9</code></p>
<p>Any message can be specified as follows:</p>
<pre><code>kasm program.kasm -c &quot;KASM is pretty neat, yo&quot;
</code></pre>
<h2><a class="header" href="#flags" id="flags">Flags</a></h2>
<p>KASM has only 3 flags:</p>
<ul>
<li><code>-h</code>, <code>--help</code> which prints the help menu</li>
<li><code>-V</code>, <code>--version</code> which prints the current KASM version</li>
<li><code>-p</code>, <code>--preprocess-only</code> which only runs the KASM preprocessor.</li>
</ul>
<h4><a class="header" href="#the--p-flag-running-in-preprocess-only-mode" id="the--p-flag-running-in-preprocess-only-mode">The <code>-p</code> Flag: Running in Preprocess Only Mode</a></h4>
<p>KASM has a fairly powerful preprocessor which can be used to write code that the assembler can use to generate the code that will eventually make its way into the finished program. These include macros, definitions, and other KASM directives. There can be a situation where it might be useful to check the output of the preprocessor, but not after the program is assembled.</p>
<p>KASM supports running in preprocessor only mode, which runs the preprocessor and outputs a <code>.kasm</code> source file with all macros and definitions expanded.</p>
<p>For example:</p>
<pre><code>kasm test.kasm -p
</code></pre>
<p>This will create a file named <code>test_preprocessed.kasm</code> in the current working directory that contains the source from <code>test.kasm</code> after the preprocessor has run.</p>
<h1><a class="header" href="#chapter-3-kasm-language" id="chapter-3-kasm-language">Chapter 3: KASM Language</a></h1>
<p>This chapter will go over the specifics of KASM assembly language without diving into assembly directives.</p>
<h1><a class="header" href="#for-beginners" id="for-beginners">For Beginners</a></h1>
<p>Hopefully by the time someone is reading this, there will be better options for non-KerbalScript code that runs inside of kOS. If you are trying to write such a program, or just want to try to learn or practice with assembly using Kerbal Space Program and kOS, then hopefully this page can give you a brief introduction to assembly language.</p>
<p>If you have previous experience with assembly language, you can probably skip this section.</p>
<p>For the purposes of this explanation, KerbalScript code will be used to try to illustrate some ideas.</p>
<h3><a class="header" href="#code" id="code">Code</a></h3>
<p>In most programming languages, when source code is written, it has to undergo a process called compilation. This turns the code that was written by the user into instructions that the computer can understand. For a lot of programming languages, there is an intermediary step between the source code, the code written by the user, and the machine code, the binary that computers can read. This intermediary step is called assembly code.</p>
<p>Take this KerbalScript code for example, that just adds two numbers and stores the result:</p>
<pre><code>SET X TO 2 + 4.
</code></pre>
<p>kOS, or most computers for that matter, have no idea what to do with this, because it is just text. Internally, kOS performs compilation to turn this code into a form that it can understand.</p>
<p>In this case, the machine code is something like this:
(special quirks of compiled kOS machine code may be discussed later)</p>
<pre><code>0x4e (2)
0x4e (4)
0x3c
0x34 (X)
</code></pre>
<p>This may be difficult to understand at first, but we will break it down:</p>
<p>Each line represents what is called an &quot;instruction&quot;</p>
<p>Computers, like kOS, can only do one thing at a time, so it cannot add 2 and 4 together and store them in a variable called X at the same time.</p>
<p>The first instruction has the <em>opcode</em> of 0x4e. 0x4e is a <em>hexadecimal</em> number. Each instruction is given a unique number that the computer knows, so it knows what operation to perform. Hexadecimal is just a way of writing this number, but in our normal base-10 number system this number is <code>78</code>. The number itself though, is not important.</p>
<p>The instruction <code>0x4e</code> is called the &quot;push&quot; instruction. Inside of kOS there is a bunch of data stacked on top of each other, aptly named the &quot;stack&quot;.<br />
The stack is used to store data that is used for something later, but not for storing things long-term like inside of variables.</p>
<p>On the first line, <code>0x4e (2)</code> means that we are &quot;pushing&quot; the value of 2 onto the stack. So the number 2 is stored somewhere. This corresponds to the 2 in our KerbalScript code.</p>
<p>On the second line <code>0x4e (4)</code>, we do the same thing, but we push the value of 4. Now the stack contains the numbers 2 and 4.</p>
<p>The third line, opcode 0x3c, means &quot;add&quot; and it tells the computer to add the last two values on the stack. In this case, that is 2 and 4. The result is then stored back on the stack, and we know that the answer is 6.</p>
<p>The final line, <code>0x34 (X)</code> is opcode 0x34 which tells kOS to store the value on the top of the stack into the variable that is given with the instruction, in this case that is 'X'.</p>
<p>At the end of this code, the numbers 2 and 4 were added, and the result was stored inside of a variable named X.</p>
<p>This is actually what is happening when the KerbalScript code above is run, and compiled.</p>
<h3><a class="header" href="#rationale" id="rationale">Rationale</a></h3>
<p>KASM is a program which allows the user to directly write these instructions instead of having to write KerbalScript. This can give the user more control over what their program does, allow them to experiment with learning new things, or to make a compiler which generates KASM assembly code which can be run inside of kOS, allowing them to create a new programming language for kOS!</p>
<p>A snippet of code in KASM that would perform the same function as the KerbalScript shown above is:</p>
<pre><code>push 2
push 4
add
sto &quot;$x&quot;
</code></pre>
<p>As you can see it can be written as a text file, and yet performs the same function!</p>
<p>How to actually write this code, or the <em>syntax</em> of KASM, is explained in these later subchapters.</p>
<h1><a class="header" href="#basic-syntax" id="basic-syntax">Basic Syntax</a></h1>
<p>Like most assemblers, each KASM source line contains some combination of four fields:</p>
<p><code>label:     instruction     operands        ; comment</code></p>
<p>Most of these fields are optional, with restriction of the operands field based on which instruction it is.</p>
<p>KASM uses backslash (\) as a continuation character; if a line ends with a backslash, the next line is considered to be a part of the backslashed line.</p>
<p>There are no restrictions places on whitespace, such as spaces or tabs, however except for when using the \ character, new lines are to be minded.</p>
<h3><a class="header" href="#basic-instructions" id="basic-instructions">Basic Instructions</a></h3>
<p>A valid source line may simply be:</p>
<pre><code>add
</code></pre>
<p>It contains only the instruction, no label, operands, or comment</p>
<p>A comment is dictated by the character <code>;</code> and can be added at the end of any source line and will effectively be ignored.</p>
<pre><code>add ; This adds the previous two numbers
</code></pre>
<p>Instructions that require operands, must be provided operands otherwise it is an error. An example for this could be the <code>push</code> instruction:</p>
<pre><code>push 2
</code></pre>
<p>This instruction would push a byte with a value of 2 onto the stack.</p>
<p>Multiple operands are seperated using a comma:</p>
<pre><code>bscp 1, 0
</code></pre>
<h3><a class="header" href="#labels" id="labels">Labels</a></h3>
<p>Sometimes in a program, one might want to stop instructions from being executed in order and re-run code, or make a decision based on input, and run certain code on certain conditions.</p>
<p>This example demonstrates simply wanting to skip over some code:</p>
<pre><code>nop ; Does nothing, just a placeholder
push 2
jmp 3 ; This instruction jumps down 3 instructions, and skips all of them
push 2
add
nop ; This is where we would jump to
</code></pre>
<p>This would skip the two <code>push 2</code> and <code>add</code> instructions. This can quickly get messy though, as a typo in the number of instructions to jump over can cause the entire program to run incorrectly. Thus, labels were created.</p>
<p>Labels are defined before an instruction, and they can either be in the line before it, or in front of it:</p>
<pre><code>label:
    nop
also_label: nop
</code></pre>
<p>Labels can be used in the place of specific places to jump to in the code, that previous program rewritten but using labels is as follows:</p>
<pre><code>    nop
    push 2
    jmp the_end
    push 2
    add
the_end:
    nop
</code></pre>
<p>Now KASM will keep track of the exact value to jump for you, and sections of code can be named, this is illustrated best by a loop:</p>
<pre><code>push 5          ; This will loop 5 times
loop:
    dup         ; Duplicates 5 so we can use it for an operation
    push 0      ; We want to compare it against 0
    cgt         ; This will compare the number and 0 and see if it is greater than 0
    bfa end     ; If the number is equal to 0, the loop is over, so we jump to the end
    push 1      ; If not, then we push a 1
    sub         ; And subtract it from the current number
    jmp loop    ; Then start the loop again
end:
    jmp 0       ; Infinite loop
</code></pre>
<h4><a class="header" href="#inner-labels" id="inner-labels">Inner Labels</a></h4>
<p>All of this example code has existed in isolation, however in larger projects, one would not want to use the label &quot;loop&quot; because duplicate labels are not allowed. The user could name every single loop something different, but this can get in the way. Inner labels were created to solve this problem.</p>
<p>Inner labels are tied to a parent label, so they can be reused later in the program if the parent label is different.</p>
<p>Inner labels are differentiated from normal labels because they begin with a <code>.</code></p>
<p>An example of this would be:</p>
<pre><code>; This program adds 2 to the variable 'x' five times

adder:              ; This is the parent label
    push 5

    .loop:          ; Inner labels start with a '.'
        dup         ; Looping logic
        push 0
        cgt
        bfa .end
        push 1
        sub

        push &quot;$x&quot;   ; Gets the current value inside of x
        push 1      
        add         ; Adds 1
        sto &quot;$x&quot;    ; Stores the result back into x

        jmp .loop
    .end:
        nop

; Somewhere else in the code
subtracter:
    .loop:          ; This is not a duplicate!
        ...
</code></pre>
<h1><a class="header" href="#data-types" id="data-types">Data Types</a></h1>
<p>In kOS, unlike in many other computing platforms, each value has an associated type.</p>
<p>These types are as follows:</p>
<table><thead><tr><th>Argument Type Value</th><th align="center">Type</th></tr></thead><tbody>
<tr><td>0</td><td align="center">NULL</td></tr>
<tr><td>1</td><td align="center">Bool</td></tr>
<tr><td>2</td><td align="center">Byte</td></tr>
<tr><td>3</td><td align="center">Int16</td></tr>
<tr><td>4</td><td align="center">Int32</td></tr>
<tr><td>5</td><td align="center">Float</td></tr>
<tr><td>6</td><td align="center">Double</td></tr>
<tr><td>7</td><td align="center">String</td></tr>
<tr><td>8</td><td align="center">ARG MARKER</td></tr>
<tr><td>9</td><td align="center">ScalarInt</td></tr>
<tr><td>10</td><td align="center">ScalarDouble</td></tr>
<tr><td>11</td><td align="center">BoolValue</td></tr>
<tr><td>12</td><td align="center">StringValue</td></tr>
</tbody></table>
<ul>
<li><strong>NULL</strong> is a value that is equivalent to &quot;nothing&quot;</li>
<li><strong>Bool</strong> is a true or false value</li>
<li><strong>Byte</strong> is an integer that can store numbers from -128 to 127</li>
<li><strong>Int16</strong> is an integer that can store numbers from -32,768 to 32,767</li>
<li><strong>Int32</strong> is an integer that can store numbers from -2,147,483,648 to 2,147,483,647</li>
<li><strong>Float</strong> is a number that can have a fractional component such as 2.33</li>
<li><strong>Double</strong> is a float, but with double the precision of the fractional component, see <a href="https://en.wikipedia.org/wiki/Double-precision_floating-point_format">this</a></li>
<li><strong>String</strong> is a &quot;string&quot; of characters, such as &quot;Hello, kOS!&quot;</li>
<li><strong>ARG MARKER</strong> is a special value used inside of kOS that marks the end of function &quot;arguments&quot;</li>
<li><strong>ScalarInt</strong> is an integer that can store the same numbers as the Int32, but has associated functions inside of kOS</li>
<li><strong>ScalarDouble</strong> is a double, but with associated functions inside of kOS</li>
<li><strong>BoolValue</strong> is a boolean value, true or false, but with associated functions</li>
<li><strong>StringValue</strong> same as a string, but with associated functions</li>
</ul>
<h3><a class="header" href="#inside-of-kasm" id="inside-of-kasm">Inside of KASM</a></h3>
<p>Data types are for the most part handled automatically by KASM</p>
<p>KASM chooses the smallest size data type in order to make the assembled executable file as small as possible.</p>
<p>For example, in the code:</p>
<pre><code>push 2
</code></pre>
<p>That 2 would be stored using the <code>Byte</code> type, meanwhile in:</p>
<pre><code>push 200
</code></pre>
<p>200 would be stored as an <code>Int16</code> because it is the smallest type that can hold the value of 200.</p>
<p>When trying to pass any floating-point number such as <code>2.33</code>, KASM will automatically store it as a ScalarDouble, because that is the default in KerbalScript, and nothing uses the regular <code>Double</code> type.</p>
<p>If you wanted to push a <code>StringValue</code> in KASM, you simply use the <code>pushv</code> pseudoinstruction:</p>
<pre><code>push  &quot;Hello&quot;        ; This is a regular String
pushv &quot;kOS!&quot;         ; This will push a StringValue
</code></pre>
<p>If given an integer, it will be pushed as a <code>ScalarInt</code>.</p>
<h3><a class="header" href="#pushing-other-types" id="pushing-other-types">Pushing Other Types</a></h3>
<p>Simply writing an integer or another value to be the operand to an instruction is simple enough, however there are still two types that are not accounted for:</p>
<ul>
<li>NULL</li>
<li>ARG MARKER</li>
</ul>
<p>These are shown in KASM code as follows:</p>
<pre><code>push # ; This is a NULL
push @ ; This is an ARG MARKER
</code></pre>
<h1><a class="header" href="#expressions" id="expressions">Expressions</a></h1>
<p>Expressions can be used in KASM in place of constants, when it is more convenient to do so.</p>
<p>In KASM, expressions either produce an integer, a double, or a boolean value.<br />
An integer is not allowed to be used in place of a boolean, nor a double. Nor a boolean in place of either.</p>
<h2><a class="header" href="#supported-operations" id="supported-operations">Supported operations</a></h2>
<h4><a class="header" href="#unary" id="unary">Unary</a></h4>
<ul>
<li><strong>-</strong> - Negate, flips the sign of a number </li>
<li><strong>~</strong> - Flips all of the bits in a given number/value</li>
<li><strong>!</strong> - Not, flips a boolean value, if it was true, now it is false, and vice-versa</li>
</ul>
<h4><a class="header" href="#mathematical" id="mathematical">Mathematical</a></h4>
<ul>
<li><strong>+</strong> - Addition</li>
<li><strong>-</strong> - Subtraction</li>
<li><strong>*</strong> - Multiplication</li>
<li><strong>/</strong> - Division</li>
<li><strong>%</strong> - Modulus (remainder operator)</li>
</ul>
<h4><a class="header" href="#comparison" id="comparison">Comparison</a></h4>
<ul>
<li><strong>==</strong> - Equals</li>
<li><strong>!=</strong> - Does not equal</li>
<li><strong>&lt;</strong> - Less than</li>
<li><strong>&lt;=</strong> - Less than or equal</li>
<li><strong>&gt;</strong> - Greater than</li>
<li><strong>&gt;=</strong> - Greater than or equal</li>
</ul>
<h4><a class="header" href="#logical" id="logical">Logical</a></h4>
<ul>
<li><strong>&amp;&amp;</strong> - Logical And</li>
<li><strong>||</strong> - Logical Or</li>
</ul>
<h2><a class="header" href="#values" id="values">Values</a></h2>
<p>In KASM, values can be provided in a few forms.</p>
<p>For integers, hex, decimal, and binary literals are all supported:</p>
<pre><code>push 24
push 0x18
push 0b0001_1000 ; Could also be 0b00011000
</code></pre>
<h2><a class="header" href="#in-practice" id="in-practice">In Practice</a></h2>
<p>Expressions can be used for any instruction operand that supports the type that is produced when the expression is evaluated</p>
<pre><code>push 2 + 2

pushv (5.0 / 2.0) &gt; 2.0
</code></pre>
<p>Becomes:</p>
<pre><code>push 4

pushv true
</code></pre>
<p>Expressions become more useful when introducing macros and definitions in future sections.</p>
<h1><a class="header" href="#full-instructions-list" id="full-instructions-list">Full Instructions List</a></h1>
<p>This is simply a list of all instructions that are in KASM, grouped by common purpose.</p>
<h2><a class="header" href="#stack-operations" id="stack-operations">Stack Operations</a></h2>
<p><strong>push</strong> (any) - Pushes a value to the stack</p>
<p><strong>pushv</strong> (any) - Pushes a value to the stack, but as kOS &quot;scalar&quot; or &quot;value&quot; versions<br />
(this instruction does not exist in kOS, it is just for the purposes of user control)</p>
<p><strong>pop</strong> - Removes the value from the top of the stack and discards it</p>
<p><strong>dup</strong> - Copies the value from the top of the stack and pushes that copy, so there are two of the original</p>
<p><strong>swap</strong> - Swaps the value on the top of the stack and the one below it</p>
<p><strong>eval</strong> - Returns the value referenced by the topmost variable on the stack</p>
<p><strong>targ</strong> - Asserts that the topmost thing on the stack is an argument marker (throws a kOS error if it isn't!)</p>
<h2><a class="header" href="#mathematical-operations" id="mathematical-operations">Mathematical Operations</a></h2>
<p>These all push the result back to the stack</p>
<p><strong>add</strong> - Adds the two arguments on top of the stack</p>
<p><strong>sub</strong> - Subtracts the two arguments on top of the stack</p>
<p><strong>mul</strong> - Multiplies the two arguments on top of the stack</p>
<p><strong>div</strong> - Divides the two arguments on top of the stack</p>
<p><strong>pow</strong> - Raises the value just under the top, to the power of the top</p>
<p><strong>neg</strong> - Pushes back the negative of the number on the top of the stack</p>
<h2><a class="header" href="#logical-operations" id="logical-operations">Logical Operations</a></h2>
<p>All of these behave in this way:</p>
<p>(this side is the value just below the top of the stack) &gt; (this is the top of the stack)</p>
<p><strong>cgt</strong> - Checks if one number is greater than the other</p>
<p><strong>clt</strong> - Less than</p>
<p><strong>cge</strong> - Greater than or equal</p>
<p><strong>cle</strong> - Less than or equal</p>
<p><strong>ceq</strong> - Equal to</p>
<p><strong>cne</strong> - Not equal to</p>
<p><strong>not</strong> - Pushes back the opposite of the boolean value on top of the stack (true -&gt; false, false -&gt; true)</p>
<p><strong>and</strong> - Pushes true, if both values on top of the stack are true</p>
<p><strong>or</strong> - Pushes true, if at least one value on top of the stack is true</p>
<h2><a class="header" href="#flow-control" id="flow-control">Flow control</a></h2>
<p><strong>eof</strong> - Tells kOS that this is the end of the file, so it should stop reading the program</p>
<p><strong>eop</strong> - Tells kOS that this is the end of the program</p>
<p><strong>nop</strong> - No-Op, does nothing</p>
<p><strong>jmp</strong> (string | int) - Unconditionally jumps to the location specified in the operand, it can be a string or an integer (for relative jumps)</p>
<p><strong>call</strong> (string), (string) - Calls a subroutine, leaving the result on the stack, both operands are strings</p>
<p><strong>ret</strong> (int) - Returns from a subroutine and pops off the number of scopes as provided in the operand</p>
<p><strong>btr</strong> (string | int) - If the value on the top of the stack is true, then it branches to the given location</p>
<p><strong>bfa</strong> (string | int) - Same as <code>btr</code> but if the value is false</p>
<p><strong>wait</strong> - Pops a duration in seconds from the stack and waits for that amount of game time</p>
<h2><a class="header" href="#variable-manipulation" id="variable-manipulation">Variable Manipulation</a></h2>
<p><strong>sto</strong> (string) - Stores the value on the top of the stack in the variable specified by the operand</p>
<p><strong>uns</strong> - Removes the variable named by the value on the top of the stack</p>
<p><strong>stol</strong> (string) - Stores the value on the top of the stack in the variable specified by the operand, but if the variable does not exist in the current scope it won't attempt to look for it in a higher scope.</p>
<p><strong>stog</strong> (string) - Stores the value on the top of the stack in the variable specified by the operand, but always stores it in a global variable.</p>
<p><strong>stoe</strong> (string) - Stores the value on the top of the stack in the variable specified by the operand, but if the variable does not exist yet, it will throw an error instead of creating a new one.</p>
<p><strong>exst</strong> - Tests if the identifier on the top of the stack is a variable, and is in scope. It will push true if it is, and false if it is not.</p>
<h2><a class="header" href="#member-values" id="member-values">Member Values</a></h2>
<p><strong>gmb</strong> (string) - Consumes the topmost value of the stack, getting the suffix of it specified by operand and putting that value back on the stack.
Ex: <code>SHIP:ALTITUDE</code></p>
<p><strong>smb</strong> (string) - Consumes a value and a destination object from the stack, setting the objects suffix specified by the operand to the value.</p>
<p><strong>gidx</strong> - Consumes an index and an target object from the stack, getting the indexed value from the object and pushing the result back on the stack.</p>
<p><strong>sidx</strong> - Consumes a value, an index, and an object from the stack, setting the specified index on the object to the given value.</p>
<p><strong>gmet</strong> - Similar to <code>gmb</code> except instead of getting the member as a value, it is called as if it was a function.<br />
Ex: <code>SHIP:NAME()</code></p>
<h2><a class="header" href="#triggers" id="triggers">Triggers</a></h2>
<p><strong>addt</strong> (bool), (int) - Pops a function pointer from the stack and adds a trigger that will be called each cycle. The second operand contains the Interrupt Priority level of the trigger. For one trigger to interrupt another, it needs a higher priority, else it waits until the first trigger is completed before it will fire.</p>
<p><strong>rmvt</strong> - Pops a function pointer from the stack and removes any triggers that call that function pointer.</p>
<h2><a class="header" href="#scopes" id="scopes">Scopes</a></h2>
<p><strong>bscp</strong> (int), (int) - Pushes a new variable namespace scope (for example, when a &quot;{&quot; is encountered in a block-scoping language), the first operand being the new scope id, and the second one being the parent scope id.</p>
<p><strong>escp</strong> (int) - Pops a variable namespace scope (for example, when a &quot;}&quot; is encountered in a block-scoping language), the operand being the number of scope depths to pop.</p>
<h2><a class="header" href="#delegates" id="delegates">Delegates</a></h2>
<p><strong>phdl</strong> (int), (bool) - Pushes a delegate object onto the stack, optionally capturing a closure.</p>
<p><strong>prl</strong> (string) - See KOS Code docs for more information.</p>
<p><strong>pdrl</strong> (string), (bool) - This serves the same purpose as <code>prl</code>, except it's for use with UserDelegates instead of raw integer IP calls.</p>
<h2><a class="header" href="#misc" id="misc">Misc.</a></h2>
<p><strong>lbrt</strong> (string) - It exists purely to store, as an operand, the label of the next opcode to follow it. Mostly used for internal kOS things.</p>
<p><strong>tcan</strong> - Tests whether or not the current subroutine context on the stack that is being executed right now is one that has been flagged as cancelled by someone having called SubroutineContext.Cancel(). This pushes a True or a False on the stack to provide the answer.  This should be the first thing done by triggers that wish to be cancel-able by other triggers.</p>
<h1><a class="header" href="#chapter-4-kasm-preprocessor" id="chapter-4-kasm-preprocessor">Chapter 4: KASM Preprocessor</a></h1>
<p>KASM contains a powerful macro processor, which supports conditional assembly, multi-level file inclusion, and two forms of macro (single-line and multi-line).</p>
<p>Preprocessor directives all start with a dot (.)</p>
<h1><a class="header" href="#single-line-macros-or-definitions" id="single-line-macros-or-definitions">Single-Line Macros, or Definitions</a></h1>
<p>Single-line macros are defined using the <code>.define</code> directive:</p>
<pre><code>.define NUM         25
</code></pre>
<p>This creates a definition called <code>NUM</code> that has the value of 25.</p>
<p>Definitions are more powerful than this though, and support expressions:</p>
<pre><code>.define OTHERNUM    NUM + 5
</code></pre>
<p>Now <code>OTHERNUM</code> would be defined as <code>NUM</code> plus 5.</p>
<p>So if <code>NUM</code> were redefined later to be 10:</p>
<pre><code>.define NUM         10
</code></pre>
<p>It would change the value of <code>OTHERNUM</code> because these values are found at invocation time.</p>
<p>A long example is:</p>
<pre><code>.define NUM         25
.define OTHERNUM    NUM + 5

push OTHERNUM

.define NUM         10

push OTHERNUM

</code></pre>
<p>becomes:</p>
<pre><code>push 30

push 15
</code></pre>
<p>Not only is this useful for helpful constants, but definitions are effectively single-line macros, and can be used with more than just constants:</p>
<pre><code>.define PUSH2      push 2

PUSH2
</code></pre>
<p>becomes:</p>
<pre><code>push 2
</code></pre>
<p>Definitions can take arguments as well:</p>
<pre><code>.define a(x) 1 + b(x)
.define b(x) 2 * x

push a(2)
</code></pre>
<p>becomes:</p>
<pre><code>push 5
</code></pre>
<p>Definitions can have multiple arguments like so:</p>
<pre><code>.define f(x, y) x + y * y
</code></pre>
<p>It is also possible to undefine a defintion using the <code>.undef</code> directive:</p>
<pre><code>.undef FOO
</code></pre>
<h1><a class="header" href="#macros" id="macros">Macros</a></h1>
<p>Multi-line macros are defined using the <code>.macro</code> and <code>.endmacro</code> directives:</p>
<pre><code>.macro MULTI
    push 2
    push 2
    add
.endmacro
</code></pre>
<pre><code>MULTI
</code></pre>
<p>Multi-line macros can also have arguments just like definitions. The number of arguments must be specified after the macro name.</p>
<p>These arguments are referenced using their positions, and using the <code>&amp;</code> symbol:</p>
<pre><code>.macro ADD 2
    push &amp;1
    push &amp;2
    add
.endmacro
</code></pre>
<pre><code>ADD(2, 4)
</code></pre>
<p>Expands to:</p>
<pre><code>push 2
push 4
add
</code></pre>
<p>Multi-Line macros can have default arguments as well, and this is specified by using a range.</p>
<p>The first number is the minimum number of required arguments, and the second number is the maximum number of required arguments.</p>
<p>A valid range would be <code>0-1</code></p>
<p>This is placed after the macro's identifier. But if default arguments are used, the default values must be given, separated by commas, after the range. The number of default values given must match the maximum number of require arguments, minus those that are required.</p>
<pre><code>.macro RET 0-1 1
    RET &amp;1
.endmacro
</code></pre>
<p>This can be invoked as:</p>
<pre><code>RET

; Expands to:

ret 1
</code></pre>
<p>or as:</p>
<pre><code>RET(2)

; Expands to:

ret 2
</code></pre>
<p>In a macro such as this:</p>
<pre><code>.macro DO_SOMETHING 0-2 24, 30
    push &amp;1
    push &amp;2
    sub
.endmacro
</code></pre>
<p>If this is invoked with only one argument, it defaults to being the first argument:</p>
<pre><code>DO_SOMETHING(2)

; Expands to:

push 2
push 30
sub
</code></pre>
<p>Just like definitions, macros can be undefined using <code>.unmacro</code>. But the number of parameters must be given:</p>
<pre><code>.macro NOTHING
    nop
.endmacro

.unmacro NOTHING ; This works

.unmacro DO_SOMETHING 2 ; This does not work, because DO_SOMETHING requires a range of 0-2, not exactly 2
</code></pre>
<h1><a class="header" href="#chapter-5-assembler-directives" id="chapter-5-assembler-directives">Chapter 5: Assembler Directives</a></h1>
<p>Along with the <code>.define</code> and <code>.macro</code> directives, comes a few more that can be useful when programming in KASM.</p>
<h3><a class="header" href="#rep---repeat" id="rep---repeat"><code>.rep</code> - Repeat</a></h3>
<p>This directive repeats the given code the amount of times that is supplied, for example:</p>
<pre><code>.rep 5
    push @
.endrep
</code></pre>
<p>This expands to:</p>
<pre><code>push @
push @
push @
push @
push @
</code></pre>
<h3><a class="header" href="#extern---external" id="extern---external"><code>.extern</code> - External</a></h3>
<p>This directive defines a symbol as external to the linker.</p>
<pre><code>.extern ADD_FUNC

call &quot;&quot;, ADD_FUNC
</code></pre>
<h3><a class="header" href="#global---global" id="global---global"><code>.global</code> - Global</a></h3>
<p>Similar to <code>.extern</code> but defines a symbol as global</p>
<pre><code>.global _start

.func
_start:
    ...
</code></pre>
<h3><a class="header" href="#func---function" id="func---function"><code>.func</code> - Function</a></h3>
<p>This directive is used to mark a certain label as a function, which is treated differently in KASM.</p>
<pre><code>.func
add_numbers:
    ...
</code></pre>
<h1><a class="header" href="#include-directive" id="include-directive">Include Directive</a></h1>
<p>The <code>.include</code> directive is a powerful preprocessor directive that allows the programmer to include source code from another file into the current file.</p>
<p>Example usage:</p>
<pre><code>.include &quot;macros.kasm&quot;

PRINT &quot;Hello, world!&quot;
</code></pre>
<p>This assumes that the source file <code>macros.kasm</code> is in the same directory as the main file, and it contains (at least):</p>
<pre><code>; macros.kasm

.macro PRINT 1
    push @
    push &amp;1
    call &quot;&quot;, &quot;print()&quot;
    pop
.endmacro
</code></pre>
<p>This causes the source code to effectively be:</p>
<pre><code>.macro PRINT 1
    push @
    push &amp;1
    call &quot;&quot;, &quot;print()&quot;
    pop
.endmacro

PRINT &quot;Hello, world!&quot;
</code></pre>
<p>This allows the programmer to organize macro definitions and other code much more effectively.</p>
<h1><a class="header" href="#if-directives" id="if-directives">If* Directives</a></h1>
<p>As stated previously, KASM supports conditional assembly, which means that some code could, or could not be included in the final binary if logic that KASM follows is met, or not.</p>
<p>These are extremely similar to C-style #if directives.</p>
<p>An example showing a few possible <code>if</code> directives:</p>
<pre><code>.define DEBUG
.define VERBOSE 2
.define PRINT_MESSAGES

.ifdef DEBUG                            ; If something is defined
    .if VERBOSE == 1                    ; Nested!
        PRINT &quot;Debug mode on!&quot;
    .elif VERBOSE == 2                  ; Else if
        PRINT &quot;Extra debug mode on!&quot;
    .elifdef PRINT_MESSAGES
        PRINT_MESSAGE(&quot;Oh no&quot;)
    .endif                              ; Must show end of if
.else
    ; Do something else
.endif
</code></pre>
<p>Other variants such as <code>.ifn</code> (if not), <code>.elifn</code> (else if not), and <code>.ifndef</code>/<code>.elifndef</code> also are supported:</p>
<ul>
<li>if    &lt;condition&gt;</li>
<li>ifn   &lt;condition&gt;</li>
<li>ifdef     &lt;identifier&gt;</li>
<li>ifndef     &lt;identifier&gt;</li>
<li>elif  &lt;condition&gt;</li>
<li>elifn &lt;condition&gt;</li>
<li>elifdef     &lt;identifier&gt;</li>
<li>elifndef     &lt;identifier&gt;</li>
<li>endif</li>
</ul>
<h1><a class="header" href="#output" id="output">Output</a></h1>
<p>KASM outputs in a file format called KO, or Kerbal Object file format.</p>
<p>This format is used by the linker to link multiple parts of a program together that were in seperate source files.</p>
<p>These files can be viewed using a program called <a href="https://github.com/newcomb-luke/KDump">KDump</a>, as well as finished KSM files.</p>
<p>KO files must be passed to the <a href="https://github.com/newcomb-luke/kOS-KLinker">linker</a> in order to become executable by kOS.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
